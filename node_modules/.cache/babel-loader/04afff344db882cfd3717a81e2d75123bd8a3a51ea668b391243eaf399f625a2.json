{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.PopupManager = void 0;\nconst tslib_1 = require(\"tslib\");\nconst events_1 = tslib_1.__importDefault(require(\"events\"));\nconst utils_1 = require(\"@trezor/utils\");\nconst events_2 = require(\"@trezor/connect/lib/events\");\nconst urlUtils_1 = require(\"@trezor/connect/lib/utils/urlUtils\");\nconst showPopupRequest_1 = require(\"./showPopupRequest\");\nconst serviceworker_window_1 = require(\"../channels/serviceworker-window\");\nconst window_window_1 = require(\"../channels/window-window\");\nconst checkIfTabExists = tabId => new Promise(resolve => {\n  if (!tabId) return resolve(false);\n  function callback() {\n    if (chrome.runtime.lastError) {\n      resolve(false);\n    } else {\n      resolve(true);\n    }\n  }\n  chrome.tabs.get(tabId, callback);\n});\nconst POPUP_REQUEST_TIMEOUT = 850;\nconst POPUP_CLOSE_INTERVAL = 500;\nconst POPUP_OPEN_TIMEOUT = 5000;\nclass PopupManager extends events_1.default {\n  constructor(settings, {\n    logger\n  }) {\n    var _a;\n    super();\n    this.locked = false;\n    this.extensionTabId = 0;\n    this.injectContentScript = tabId => {\n      chrome.permissions.getAll(permissions => {\n        var _a;\n        if ((_a = permissions.permissions) === null || _a === void 0 ? void 0 : _a.includes('scripting')) {\n          chrome.scripting.executeScript({\n            target: {\n              tabId\n            },\n            func: () => {}\n          }).then(() => this.logger.debug('content script injected')).catch(error => this.logger.error('content script injection error', error));\n        } else {}\n      });\n    };\n    this.settings = settings;\n    this.origin = (0, urlUtils_1.getOrigin)(settings.popupSrc);\n    this.logger = logger;\n    if (this.settings.env === 'webextension') {\n      this.channel = new serviceworker_window_1.ServiceWorkerWindowChannel({\n        name: 'trezor-connect',\n        channel: {\n          here: '@trezor/connect-webextension',\n          peer: '@trezor/connect-content-script'\n        },\n        logger,\n        currentId: () => {\n          var _a, _b;\n          if (((_a = this.popupWindow) === null || _a === void 0 ? void 0 : _a.mode) === 'tab') return (_b = this.popupWindow) === null || _b === void 0 ? void 0 : _b.tab.id;\n        },\n        legacyMode: !this.settings.useCoreInPopup\n      });\n    } else {\n      this.channel = new window_window_1.WindowWindowChannel({\n        windowHere: window,\n        windowPeer: () => {\n          var _a, _b;\n          if (((_a = this.popupWindow) === null || _a === void 0 ? void 0 : _a.mode) === 'window') return (_b = this.popupWindow) === null || _b === void 0 ? void 0 : _b.window;\n        },\n        channel: {\n          here: '@trezor/connect-web',\n          peer: '@trezor/connect-popup'\n        },\n        logger,\n        origin: this.origin\n      });\n    }\n    if (!this.settings.useCoreInPopup) {\n      this.iframeHandshakePromise = (0, utils_1.createDeferred)(events_2.IFRAME.LOADED);\n      this.channelIframe = new window_window_1.WindowWindowChannel({\n        windowHere: window,\n        windowPeer: () => window,\n        channel: {\n          here: '@trezor/connect-web',\n          peer: '@trezor/connect-iframe'\n        },\n        logger,\n        origin: this.origin\n      });\n      (_a = this.channelIframe) === null || _a === void 0 ? void 0 : _a.on('message', this.handleMessage.bind(this));\n    }\n    if (this.settings.useCoreInPopup) {\n      this.handshakePromise = (0, utils_1.createDeferred)();\n      this.channel.on('message', this.handleCoreMessage.bind(this));\n    } else if (this.settings.env === 'webextension') {\n      this.channel.on('message', this.handleExtensionMessage.bind(this));\n    } else {\n      this.channel.on('message', this.handleMessage.bind(this));\n    }\n    this.channel.init();\n  }\n  async request() {\n    var _a, _b, _c, _d, _f;\n    if (this.settings.useCoreInPopup && ((_a = this.popupWindow) === null || _a === void 0 ? void 0 : _a.mode) === 'tab') {\n      const currentPopupExists = await checkIfTabExists((_c = (_b = this.popupWindow) === null || _b === void 0 ? void 0 : _b.tab) === null || _c === void 0 ? void 0 : _c.id);\n      if (!currentPopupExists) {\n        this.clear();\n      }\n    }\n    if (this.locked) {\n      if (((_d = this.popupWindow) === null || _d === void 0 ? void 0 : _d.mode) === 'tab' && this.popupWindow.tab.id) {\n        chrome.tabs.update(this.popupWindow.tab.id, {\n          active: true\n        });\n      } else if (((_f = this.popupWindow) === null || _f === void 0 ? void 0 : _f.mode) === 'window') {\n        this.popupWindow.window.focus();\n      }\n      return;\n    }\n    if (this.popupWindow && !this.locked) {\n      this.close();\n    }\n    const openFn = this.open.bind(this);\n    this.locked = true;\n    const timeout = this.settings.env === 'webextension' ? 1 : POPUP_REQUEST_TIMEOUT;\n    this.requestTimeout = setTimeout(() => {\n      this.requestTimeout = undefined;\n      openFn();\n    }, timeout);\n  }\n  unlock() {\n    this.locked = false;\n  }\n  open() {\n    const src = this.settings.popupSrc;\n    this.popupPromise = (0, utils_1.createDeferred)(events_2.POPUP.LOADED);\n    this.openWrapper(src);\n    if (this.settings.useCoreInPopup) {\n      return;\n    }\n    this.closeInterval = setInterval(() => {\n      if (!this.popupWindow) return;\n      if (this.popupWindow.mode === 'tab' && this.popupWindow.tab.id) {\n        chrome.tabs.get(this.popupWindow.tab.id, tab => {\n          if (!tab) {\n            this.emit(events_2.POPUP.CLOSED);\n            this.clear();\n          }\n        });\n      } else if (this.popupWindow.mode === 'window' && this.popupWindow.window.closed) {\n        this.clear();\n        this.emit(events_2.POPUP.CLOSED);\n      }\n    }, POPUP_CLOSE_INTERVAL);\n    this.openTimeout = setTimeout(() => {\n      this.clear();\n      (0, showPopupRequest_1.showPopupRequest)(this.open.bind(this), () => {\n        this.emit(events_2.POPUP.CLOSED);\n      });\n    }, POPUP_OPEN_TIMEOUT);\n  }\n  openWrapper(url) {\n    if (this.settings.env === 'webextension') {\n      chrome.windows.getCurrent(currentWindow => {\n        this.logger.debug('opening popup. currentWindow: ', currentWindow);\n        if (currentWindow.type !== 'normal') {\n          chrome.windows.create({\n            url\n          }, newWindow => {\n            chrome.tabs.query({\n              windowId: newWindow === null || newWindow === void 0 ? void 0 : newWindow.id,\n              active: true\n            }, tabs => {\n              this.popupWindow = {\n                mode: 'tab',\n                tab: tabs[0]\n              };\n              this.injectContentScript(tabs[0].id);\n            });\n          });\n        } else {\n          chrome.tabs.query({\n            currentWindow: true,\n            active: true\n          }, tabs => {\n            this.extensionTabId = tabs[0].id;\n            chrome.tabs.create({\n              url,\n              index: tabs[0].index + 1\n            }, tab => {\n              this.popupWindow = {\n                mode: 'tab',\n                tab\n              };\n              this.injectContentScript(tab.id);\n            });\n          });\n        }\n      });\n    } else {\n      const windowResult = window.open(url, 'modal');\n      if (!windowResult) return;\n      this.popupWindow = {\n        mode: 'window',\n        window: windowResult\n      };\n    }\n    if (!this.channel.isConnected) {\n      this.channel.connect();\n    }\n  }\n  handleCoreMessage(message) {\n    var _a;\n    if (message.type === events_2.POPUP.LOADED) {\n      this.handleMessage(message);\n    } else if (message.type === events_2.POPUP.CORE_LOADED) {\n      this.channel.postMessage({\n        type: events_2.POPUP.HANDSHAKE,\n        payload: {\n          settings: this.settings\n        }\n      });\n      (_a = this.handshakePromise) === null || _a === void 0 ? void 0 : _a.resolve();\n    } else if (message.type === events_2.POPUP.CLOSED) {\n      this.channel.resolveMessagePromises({\n        code: 'Method_Interrupted',\n        error: events_2.POPUP.CLOSED\n      });\n    }\n  }\n  handleExtensionMessage(data) {\n    if (data.type === events_2.POPUP.ERROR || data.type === events_2.POPUP.LOADED || data.type === events_2.POPUP.BOOTSTRAP) {\n      this.handleMessage(data);\n    } else if (data.type === events_2.POPUP.EXTENSION_USB_PERMISSIONS) {\n      chrome.tabs.query({\n        currentWindow: true,\n        active: true\n      }, tabs => {\n        chrome.tabs.create({\n          url: 'trezor-usb-permissions.html',\n          index: tabs[0].index + 1\n        }, _tab => {});\n      });\n    } else if (data.type === events_2.POPUP.CLOSE_WINDOW) {\n      this.clear();\n    }\n  }\n  handleMessage(data) {\n    var _a, _b;\n    if (data.type === events_2.IFRAME.LOADED) {\n      (_a = this.iframeHandshakePromise) === null || _a === void 0 ? void 0 : _a.resolve(data.payload);\n    } else if (data.type === events_2.POPUP.BOOTSTRAP) {\n      if (this.openTimeout) clearTimeout(this.openTimeout);\n    } else if (data.type === events_2.POPUP.ERROR && this.popupWindow) {\n      const errorMessage = data.payload && typeof data.payload.error === 'string' ? data.payload.error : null;\n      this.emit(events_2.POPUP.CLOSED, errorMessage ? `Popup error: ${errorMessage}` : null);\n      this.clear();\n    } else if (data.type === events_2.POPUP.LOADED) {\n      if (this.openTimeout) clearTimeout(this.openTimeout);\n      if (this.popupPromise) {\n        this.popupPromise.resolve();\n      }\n      (_b = this.iframeHandshakePromise) === null || _b === void 0 ? void 0 : _b.promise.then(payload => {\n        this.channel.postMessage({\n          type: events_2.POPUP.INIT,\n          payload: Object.assign(Object.assign({}, payload), {\n            settings: this.settings\n          })\n        });\n      });\n    } else if (data.type === events_2.POPUP.CANCEL_POPUP_REQUEST || data.type === events_2.UI.CLOSE_UI_WINDOW) {\n      this.clear(false);\n    }\n  }\n  clear(focus = true) {\n    this.locked = false;\n    this.popupPromise = undefined;\n    this.handshakePromise = (0, utils_1.createDeferred)();\n    if (this.channel) {\n      this.channel.disconnect();\n    }\n    if (this.requestTimeout) {\n      clearTimeout(this.requestTimeout);\n      this.requestTimeout = undefined;\n    }\n    if (this.openTimeout) {\n      clearTimeout(this.openTimeout);\n      this.openTimeout = undefined;\n    }\n    if (this.closeInterval) {\n      clearInterval(this.closeInterval);\n      this.closeInterval = undefined;\n    }\n    if (focus && this.extensionTabId) {\n      chrome.tabs.update(this.extensionTabId, {\n        active: true\n      });\n      this.extensionTabId = 0;\n    }\n  }\n  close() {\n    if (!this.popupWindow) return;\n    this.logger.debug('closing popup');\n    if (this.popupWindow.mode === 'tab') {\n      let _e = chrome.runtime.lastError;\n      if (this.popupWindow.tab.id) {\n        chrome.tabs.remove(this.popupWindow.tab.id, () => {\n          _e = chrome.runtime.lastError;\n          if (_e) {\n            this.logger.error('closed with error', _e);\n          }\n        });\n      }\n    } else if (this.popupWindow.mode === 'window') {\n      this.popupWindow.window.close();\n    }\n    this.popupWindow = undefined;\n  }\n  async postMessage(message) {\n    var _a, _b;\n    if (!this.popupWindow && message.type !== events_2.UI.REQUEST_UI_WINDOW && this.openTimeout) {\n      this.clear();\n      (0, showPopupRequest_1.showPopupRequest)(this.open.bind(this), () => {\n        this.emit(events_2.POPUP.CLOSED);\n      });\n      return;\n    }\n    if (this.popupPromise) {\n      await this.popupPromise.promise;\n    }\n    if (((_a = this.popupWindow) === null || _a === void 0 ? void 0 : _a.mode) === 'window') {\n      this.popupWindow.window.postMessage(message, this.origin);\n    } else if (((_b = this.popupWindow) === null || _b === void 0 ? void 0 : _b.mode) === 'tab') {\n      this.channel.postMessage(message);\n    }\n  }\n}\nexports.PopupManager = PopupManager;","map":{"version":3,"names":["Object","defineProperty","exports","value","PopupManager","tslib_1","require","events_1","__importDefault","utils_1","events_2","urlUtils_1","showPopupRequest_1","serviceworker_window_1","window_window_1","checkIfTabExists","tabId","Promise","resolve","callback","chrome","runtime","lastError","tabs","get","POPUP_REQUEST_TIMEOUT","POPUP_CLOSE_INTERVAL","POPUP_OPEN_TIMEOUT","default","constructor","settings","logger","_a","locked","extensionTabId","injectContentScript","permissions","getAll","includes","scripting","executeScript","target","func","then","debug","catch","error","origin","getOrigin","popupSrc","env","channel","ServiceWorkerWindowChannel","name","here","peer","currentId","_b","popupWindow","mode","tab","id","legacyMode","useCoreInPopup","WindowWindowChannel","windowHere","window","windowPeer","iframeHandshakePromise","createDeferred","IFRAME","LOADED","channelIframe","on","handleMessage","bind","handshakePromise","handleCoreMessage","handleExtensionMessage","init","request","_c","_d","_f","currentPopupExists","clear","update","active","focus","close","openFn","open","timeout","requestTimeout","setTimeout","undefined","unlock","src","popupPromise","POPUP","openWrapper","closeInterval","setInterval","emit","CLOSED","closed","openTimeout","showPopupRequest","url","windows","getCurrent","currentWindow","type","create","newWindow","query","windowId","index","windowResult","isConnected","connect","message","CORE_LOADED","postMessage","HANDSHAKE","payload","resolveMessagePromises","code","data","ERROR","BOOTSTRAP","EXTENSION_USB_PERMISSIONS","_tab","CLOSE_WINDOW","clearTimeout","errorMessage","promise","INIT","assign","CANCEL_POPUP_REQUEST","UI","CLOSE_UI_WINDOW","disconnect","clearInterval","_e","remove","REQUEST_UI_WINDOW"],"sources":["C:/Users/delll/Desktop/mini/node_modules/@trezor/connect-web/lib/popup/index.js"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.PopupManager = void 0;\nconst tslib_1 = require(\"tslib\");\nconst events_1 = tslib_1.__importDefault(require(\"events\"));\nconst utils_1 = require(\"@trezor/utils\");\nconst events_2 = require(\"@trezor/connect/lib/events\");\nconst urlUtils_1 = require(\"@trezor/connect/lib/utils/urlUtils\");\nconst showPopupRequest_1 = require(\"./showPopupRequest\");\nconst serviceworker_window_1 = require(\"../channels/serviceworker-window\");\nconst window_window_1 = require(\"../channels/window-window\");\nconst checkIfTabExists = (tabId) => new Promise(resolve => {\n    if (!tabId)\n        return resolve(false);\n    function callback() {\n        if (chrome.runtime.lastError) {\n            resolve(false);\n        }\n        else {\n            resolve(true);\n        }\n    }\n    chrome.tabs.get(tabId, callback);\n});\nconst POPUP_REQUEST_TIMEOUT = 850;\nconst POPUP_CLOSE_INTERVAL = 500;\nconst POPUP_OPEN_TIMEOUT = 5000;\nclass PopupManager extends events_1.default {\n    constructor(settings, { logger }) {\n        var _a;\n        super();\n        this.locked = false;\n        this.extensionTabId = 0;\n        this.injectContentScript = (tabId) => {\n            chrome.permissions.getAll(permissions => {\n                var _a;\n                if ((_a = permissions.permissions) === null || _a === void 0 ? void 0 : _a.includes('scripting')) {\n                    chrome.scripting\n                        .executeScript({\n                        target: { tabId },\n                        func: () => {\n                        },\n                    })\n                        .then(() => this.logger.debug('content script injected'))\n                        .catch(error => this.logger.error('content script injection error', error));\n                }\n                else {\n                }\n            });\n        };\n        this.settings = settings;\n        this.origin = (0, urlUtils_1.getOrigin)(settings.popupSrc);\n        this.logger = logger;\n        if (this.settings.env === 'webextension') {\n            this.channel = new serviceworker_window_1.ServiceWorkerWindowChannel({\n                name: 'trezor-connect',\n                channel: {\n                    here: '@trezor/connect-webextension',\n                    peer: '@trezor/connect-content-script',\n                },\n                logger,\n                currentId: () => {\n                    var _a, _b;\n                    if (((_a = this.popupWindow) === null || _a === void 0 ? void 0 : _a.mode) === 'tab')\n                        return (_b = this.popupWindow) === null || _b === void 0 ? void 0 : _b.tab.id;\n                },\n                legacyMode: !this.settings.useCoreInPopup,\n            });\n        }\n        else {\n            this.channel = new window_window_1.WindowWindowChannel({\n                windowHere: window,\n                windowPeer: () => {\n                    var _a, _b;\n                    if (((_a = this.popupWindow) === null || _a === void 0 ? void 0 : _a.mode) === 'window')\n                        return (_b = this.popupWindow) === null || _b === void 0 ? void 0 : _b.window;\n                },\n                channel: {\n                    here: '@trezor/connect-web',\n                    peer: '@trezor/connect-popup',\n                },\n                logger,\n                origin: this.origin,\n            });\n        }\n        if (!this.settings.useCoreInPopup) {\n            this.iframeHandshakePromise = (0, utils_1.createDeferred)(events_2.IFRAME.LOADED);\n            this.channelIframe = new window_window_1.WindowWindowChannel({\n                windowHere: window,\n                windowPeer: () => window,\n                channel: {\n                    here: '@trezor/connect-web',\n                    peer: '@trezor/connect-iframe',\n                },\n                logger,\n                origin: this.origin,\n            });\n            (_a = this.channelIframe) === null || _a === void 0 ? void 0 : _a.on('message', this.handleMessage.bind(this));\n        }\n        if (this.settings.useCoreInPopup) {\n            this.handshakePromise = (0, utils_1.createDeferred)();\n            this.channel.on('message', this.handleCoreMessage.bind(this));\n        }\n        else if (this.settings.env === 'webextension') {\n            this.channel.on('message', this.handleExtensionMessage.bind(this));\n        }\n        else {\n            this.channel.on('message', this.handleMessage.bind(this));\n        }\n        this.channel.init();\n    }\n    async request() {\n        var _a, _b, _c, _d, _f;\n        if (this.settings.useCoreInPopup && ((_a = this.popupWindow) === null || _a === void 0 ? void 0 : _a.mode) === 'tab') {\n            const currentPopupExists = await checkIfTabExists((_c = (_b = this.popupWindow) === null || _b === void 0 ? void 0 : _b.tab) === null || _c === void 0 ? void 0 : _c.id);\n            if (!currentPopupExists) {\n                this.clear();\n            }\n        }\n        if (this.locked) {\n            if (((_d = this.popupWindow) === null || _d === void 0 ? void 0 : _d.mode) === 'tab' && this.popupWindow.tab.id) {\n                chrome.tabs.update(this.popupWindow.tab.id, { active: true });\n            }\n            else if (((_f = this.popupWindow) === null || _f === void 0 ? void 0 : _f.mode) === 'window') {\n                this.popupWindow.window.focus();\n            }\n            return;\n        }\n        if (this.popupWindow && !this.locked) {\n            this.close();\n        }\n        const openFn = this.open.bind(this);\n        this.locked = true;\n        const timeout = this.settings.env === 'webextension' ? 1 : POPUP_REQUEST_TIMEOUT;\n        this.requestTimeout = setTimeout(() => {\n            this.requestTimeout = undefined;\n            openFn();\n        }, timeout);\n    }\n    unlock() {\n        this.locked = false;\n    }\n    open() {\n        const src = this.settings.popupSrc;\n        this.popupPromise = (0, utils_1.createDeferred)(events_2.POPUP.LOADED);\n        this.openWrapper(src);\n        if (this.settings.useCoreInPopup) {\n            return;\n        }\n        this.closeInterval = setInterval(() => {\n            if (!this.popupWindow)\n                return;\n            if (this.popupWindow.mode === 'tab' && this.popupWindow.tab.id) {\n                chrome.tabs.get(this.popupWindow.tab.id, tab => {\n                    if (!tab) {\n                        this.emit(events_2.POPUP.CLOSED);\n                        this.clear();\n                    }\n                });\n            }\n            else if (this.popupWindow.mode === 'window' && this.popupWindow.window.closed) {\n                this.clear();\n                this.emit(events_2.POPUP.CLOSED);\n            }\n        }, POPUP_CLOSE_INTERVAL);\n        this.openTimeout = setTimeout(() => {\n            this.clear();\n            (0, showPopupRequest_1.showPopupRequest)(this.open.bind(this), () => {\n                this.emit(events_2.POPUP.CLOSED);\n            });\n        }, POPUP_OPEN_TIMEOUT);\n    }\n    openWrapper(url) {\n        if (this.settings.env === 'webextension') {\n            chrome.windows.getCurrent(currentWindow => {\n                this.logger.debug('opening popup. currentWindow: ', currentWindow);\n                if (currentWindow.type !== 'normal') {\n                    chrome.windows.create({ url }, newWindow => {\n                        chrome.tabs.query({\n                            windowId: newWindow === null || newWindow === void 0 ? void 0 : newWindow.id,\n                            active: true,\n                        }, tabs => {\n                            this.popupWindow = { mode: 'tab', tab: tabs[0] };\n                            this.injectContentScript(tabs[0].id);\n                        });\n                    });\n                }\n                else {\n                    chrome.tabs.query({\n                        currentWindow: true,\n                        active: true,\n                    }, tabs => {\n                        this.extensionTabId = tabs[0].id;\n                        chrome.tabs.create({\n                            url,\n                            index: tabs[0].index + 1,\n                        }, tab => {\n                            this.popupWindow = { mode: 'tab', tab };\n                            this.injectContentScript(tab.id);\n                        });\n                    });\n                }\n            });\n        }\n        else {\n            const windowResult = window.open(url, 'modal');\n            if (!windowResult)\n                return;\n            this.popupWindow = { mode: 'window', window: windowResult };\n        }\n        if (!this.channel.isConnected) {\n            this.channel.connect();\n        }\n    }\n    handleCoreMessage(message) {\n        var _a;\n        if (message.type === events_2.POPUP.LOADED) {\n            this.handleMessage(message);\n        }\n        else if (message.type === events_2.POPUP.CORE_LOADED) {\n            this.channel.postMessage({\n                type: events_2.POPUP.HANDSHAKE,\n                payload: { settings: this.settings },\n            });\n            (_a = this.handshakePromise) === null || _a === void 0 ? void 0 : _a.resolve();\n        }\n        else if (message.type === events_2.POPUP.CLOSED) {\n            this.channel.resolveMessagePromises({\n                code: 'Method_Interrupted',\n                error: events_2.POPUP.CLOSED,\n            });\n        }\n    }\n    handleExtensionMessage(data) {\n        if (data.type === events_2.POPUP.ERROR ||\n            data.type === events_2.POPUP.LOADED ||\n            data.type === events_2.POPUP.BOOTSTRAP) {\n            this.handleMessage(data);\n        }\n        else if (data.type === events_2.POPUP.EXTENSION_USB_PERMISSIONS) {\n            chrome.tabs.query({\n                currentWindow: true,\n                active: true,\n            }, tabs => {\n                chrome.tabs.create({\n                    url: 'trezor-usb-permissions.html',\n                    index: tabs[0].index + 1,\n                }, _tab => {\n                });\n            });\n        }\n        else if (data.type === events_2.POPUP.CLOSE_WINDOW) {\n            this.clear();\n        }\n    }\n    handleMessage(data) {\n        var _a, _b;\n        if (data.type === events_2.IFRAME.LOADED) {\n            (_a = this.iframeHandshakePromise) === null || _a === void 0 ? void 0 : _a.resolve(data.payload);\n        }\n        else if (data.type === events_2.POPUP.BOOTSTRAP) {\n            if (this.openTimeout)\n                clearTimeout(this.openTimeout);\n        }\n        else if (data.type === events_2.POPUP.ERROR && this.popupWindow) {\n            const errorMessage = data.payload && typeof data.payload.error === 'string' ? data.payload.error : null;\n            this.emit(events_2.POPUP.CLOSED, errorMessage ? `Popup error: ${errorMessage}` : null);\n            this.clear();\n        }\n        else if (data.type === events_2.POPUP.LOADED) {\n            if (this.openTimeout)\n                clearTimeout(this.openTimeout);\n            if (this.popupPromise) {\n                this.popupPromise.resolve();\n            }\n            (_b = this.iframeHandshakePromise) === null || _b === void 0 ? void 0 : _b.promise.then(payload => {\n                this.channel.postMessage({\n                    type: events_2.POPUP.INIT,\n                    payload: Object.assign(Object.assign({}, payload), { settings: this.settings }),\n                });\n            });\n        }\n        else if (data.type === events_2.POPUP.CANCEL_POPUP_REQUEST || data.type === events_2.UI.CLOSE_UI_WINDOW) {\n            this.clear(false);\n        }\n    }\n    clear(focus = true) {\n        this.locked = false;\n        this.popupPromise = undefined;\n        this.handshakePromise = (0, utils_1.createDeferred)();\n        if (this.channel) {\n            this.channel.disconnect();\n        }\n        if (this.requestTimeout) {\n            clearTimeout(this.requestTimeout);\n            this.requestTimeout = undefined;\n        }\n        if (this.openTimeout) {\n            clearTimeout(this.openTimeout);\n            this.openTimeout = undefined;\n        }\n        if (this.closeInterval) {\n            clearInterval(this.closeInterval);\n            this.closeInterval = undefined;\n        }\n        if (focus && this.extensionTabId) {\n            chrome.tabs.update(this.extensionTabId, { active: true });\n            this.extensionTabId = 0;\n        }\n    }\n    close() {\n        if (!this.popupWindow)\n            return;\n        this.logger.debug('closing popup');\n        if (this.popupWindow.mode === 'tab') {\n            let _e = chrome.runtime.lastError;\n            if (this.popupWindow.tab.id) {\n                chrome.tabs.remove(this.popupWindow.tab.id, () => {\n                    _e = chrome.runtime.lastError;\n                    if (_e) {\n                        this.logger.error('closed with error', _e);\n                    }\n                });\n            }\n        }\n        else if (this.popupWindow.mode === 'window') {\n            this.popupWindow.window.close();\n        }\n        this.popupWindow = undefined;\n    }\n    async postMessage(message) {\n        var _a, _b;\n        if (!this.popupWindow && message.type !== events_2.UI.REQUEST_UI_WINDOW && this.openTimeout) {\n            this.clear();\n            (0, showPopupRequest_1.showPopupRequest)(this.open.bind(this), () => {\n                this.emit(events_2.POPUP.CLOSED);\n            });\n            return;\n        }\n        if (this.popupPromise) {\n            await this.popupPromise.promise;\n        }\n        if (((_a = this.popupWindow) === null || _a === void 0 ? void 0 : _a.mode) === 'window') {\n            this.popupWindow.window.postMessage(message, this.origin);\n        }\n        else if (((_b = this.popupWindow) === null || _b === void 0 ? void 0 : _b.mode) === 'tab') {\n            this.channel.postMessage(message);\n        }\n    }\n}\nexports.PopupManager = PopupManager;\n//# sourceMappingURL=index.js.map"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}